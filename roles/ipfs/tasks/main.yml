---
- name: Create a dedicated user
  user:
    name: "{{ user_name }}"
    create_home: yes

- name: Extract ipfs binary
  unarchive:
    src: https://dist.ipfs.io/go-ipfs/{{ ipfs_version }}/go-ipfs_{{ ipfs_version }}_linux-amd64.tar.gz
    dest: /usr/local/bin
    extra_opts:
      - "--strip=1"
      - go-ipfs/ipfs
    mode: 0755
    remote_src: yes

- name: Create systemd service
  template:
    src: ipfs@.service
    dest: /etc/systemd/system/ipfs@.service

- name: Start and enable ipfs systemd service
  systemd:
    state: started
    enabled: yes
    name: ipfs@{{ user_name }}
    daemon_reload: yes
